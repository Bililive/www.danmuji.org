---
hide: true
title: 点歌姬
auther: 宅急送队长
plugin_author: 宅急送队长
plugin_name: 点歌姬
plugin_desc: 用弹幕来播放歌曲吧
plugin_version: 2.0.0
plugin_update_datetime: 2017-08-04 16:47:00 +0800
#plugin_update_desc: |-
#  扒拉扒拉扒拉测试
#  测试，测试测试。
#  换行。
plugin_dllink: /resource/DGJ/DGJ2.0.0.7z
plugin_dlnote: 看这个页面右侧的使用说明！
---

本页面最下面的页脚处有QQ群（问问题之前请先通读本使用说明）

---

[点歌姬v3已发布，点此下载](/plugins/DGJv3)。 v2将会继续提供下载，直到 v3 完全稳定。

---

“点歌姬”和“B站弹幕姬”是独立工作的程序，支持和所有直播软件同时使用。

1. [安装插件相关](#install)
2. [基本使用](#usage)
    1. [弹幕命令](#usage_cmd)
    2. [界面](#usage_gui)
    3. [输出文本信息](#usage_output)
    
<!--3. [开发歌曲搜索模块](#dev)-->

<br/>

## <a name="install"></a>安装插件

“点歌姬” 为 “[B站弹幕姬](/)”的插件，下载的压缩包里的 `DMPlugin_DGJ.dll` 为点歌姬插件文件。  
安装弹幕姬之后，将点歌姬压缩包里的插件文件解压放到弹幕姬插件文件夹里，重启弹幕姬。  
插件文件夹位置：```文档\弹幕姬\Plugins```（Win7中，“文档” 叫做 “我的文档”）

<img class="shadow" src="/resource/DGJ/docu.png" alt="文档的位置" />

<br/>

如果安装插件后提示 “同步初始化出错” 类似字样，请先尝试安装 .NET Framework 4.6.2，点歌姬的压缩包里已附带一份在线安装包。  
如安装后依旧出错，或有其他错误。请将桌面上生成的错误日志发给插件作者，谢谢。

<br/>

## <a name="usage"></a>基本使用

在弹幕姬的插件面板，右键插件有三个选项：

- 启用 - 启用插件，启用后插件才能处理弹幕信息
- 禁用 - 禁用插件，点歌姬禁用后会继续播放已经点上的歌曲
- 管理 - 打开插件的界面

插件需要先启用之后才能响应弹幕操作，管理插件不需要先启用插件

<img class="shadow" src="/resource/DGJ/admin.png" alt="弹幕姬插件面板" />

<br/>

### <a name="usage_cmd"></a>弹幕命令

所有人都可以使用的命令：

- ```点歌 歌名``` - 点歌
  - ```點歌```
- ```取消点歌``` - 取消自己点的最后一首歌，已经开始播放的不能取消
  - ```取消點歌```
- ```切歌``` - 投票切歌，此功能默认关闭

必须是房管/主播，并且启用弹幕控制才能使用的：

- ```%暂停``` - 暂停播放
  - ```%暫停```
- ```%播放``` - 继续播放
- ```%切歌``` - 强制跳过当前正在播放的歌曲
- ```%删歌 序号``` - 删除某个歌曲
  - ```%刪歌 序号```
- ```%优先 序号``` - 调整序号位置的歌曲到第2位。如果歌曲已经在前两位，则不操作。
  - ```%優先 序号```
- ```%音量 0-100``` - 调整歌曲音量
- ```%上限 数字``` - 调整点歌数量上限

<!-- - ```%歌词``` - 开关是否搜索歌词 -->

<!--
一般情况下用不到的命令：

 ```%保存配置``` - 保存当前配置到文件
 ```%加载配置``` - 从文件重新加载配置
-->
<br/>

### <a name="usage_gui"></a>界面

在弹幕姬的插件面板，右键 “点歌姬”，点击“管理”打开界面。  
在点歌姬的搜索模块界面可以选择使用哪个搜索模块。

<br/>

### <a name="usage_output"></a>输出文本信息

“点歌姬” 和 “B站弹幕姬” 不依赖于任何直播软件。所有支持从文件读取文字显示的直播软件都能显示点歌姬的歌曲信息

点歌姬的所有输出文本都在```文档\弹幕姬\Plugins\点歌姬\输出文本```中。  
目前有三个文件： ```歌词输出.txt``` ```日志输出.txt``` ```歌曲信息.txt```  

- 歌词输出.txt
  - 默认输出两行歌词。可在点歌姬设置中修改为输出一行。
- 日志输出.txt
  - 输出点歌成功失败、下载成功失败等信息<br>适合嫌 歌曲信息 占直播画面太大的主播使用<br>默认每条日志显示 5 秒，可在设置中修改
- 歌曲信息.txt
  - 输出点歌姬的歌曲列表、播放状态等信息<br>输出的歌曲数量、输出格式可在点歌姬中修改

<br/>

OBS Studio 添加来源方法：

1. 在 “来源” 中右键，添加一个 `文本 (GDI+)` 来源
2. 给来源设置一个容易区分的名字
3. 勾选 “从文件读取”
4. 点击 “浏览” 按钮，选择一个 txt 文件
5. 调整颜色、字体、样式到想要的样子

哔哩哔哩直播姬添加来源方法：

1. 点击左下角的 “文本”
2. 给来源设置一个容易区分的名字
3. 勾选 “从文件读” 
4. 点击 “浏览” 按钮，选择一个 txt 文件
5. 调整颜色、字体、样式到想要的样子

OBS Classic 添加来源方法：

1. 在 “来源” 中右键，选择 “添加”、“文字来源”
2. 随便填写一个容易区分的来源名字，确认
3. 勾选 “使用文件中的文字”
4. 点击 “浏览” 按钮，选择一个 txt 文件
5. 调整颜色、字体、样式到想要的样子

<br/>

<img class="shadow" src="/resource/DGJ/obss.png" alt="点歌输出信息" />

<br/>

<!--
开发，不存在的


## <a name="dev"></a>**面向开发者-开发歌曲搜索模块**

### 基本开发方法：

1. VS 中新建一个 C# 类库工程，引用 DMPlugin_DGJ.dll
2. 新建一个 public 类，继承```SongsSearchModule```类
3. 在构造函数中调用setInfo(搜索模块名字, 作者名字, 联系方式, 版本号, 介绍, 是否支持歌词);
4. ```Override Search```方法，三个参数分别为点歌人名字、搜索关键词、是否需要歌词。返回```SongItem```，```SongItem.init(this, 歌名, 歌曲ID, 点歌人名字, 歌手数组, 下载地址, 歌词);``` 如没有搜索到歌曲请返回null
5. 如需搜索模块负责歌曲文件的下载（不能使用 http/https 下载的情况），请设置 ```_HandleDownload = true;```，然后重写```Download(SongItem item)```方法。在```Download```方法中将```item.DownloadURL```下载到```item.FilePath```的位置。此处将只在由本搜索模块搜索的歌曲下载时调用。请在此处注意**不要卡死**，务必做好超时取消的功能。下载成功返回0，下载失败返回1
6. 如果需要有设置界面，请设置 ```_NeedSettings = true; ```然后重写```Setting()```方法。一般情况下不建议带设置/GUI，请只在必须时使用。启用设置的情况下，在点歌姬的搜索模块界面右键搜索模块时会多出一个 “设置” 选项

<br/>

### 注：

- **以上所有方法均会在不同线程调用，请注意线程同步和UI操作**
- 如需 XML 注释文件请私聊我（其实感觉也用不到，东西不多）
- namespace 和 class 名没有要求
- 同一个项目允许创建多个搜索模块，点歌姬会依次加载
- 如果某个搜索模块在构造函数出错，点歌姬会跳过，继续加载同文件中其他的搜索模块（如果有多个搜索模块的话）
- 点歌姬搜索模块的后缀是 gem，本质只是**DLL重命名**（手动滑稽），因为比较方便小白用户描述
- 点歌姬将只加载曲源文件夹中的 gem 文件。
- 如需解析 Json，请使用弹幕姬中已经自带了的```Newtonsoft.Json```

<br/>

### 示例：

```csharp
using DMPlugin_DGJ;
using System;
using System.Text;

namespace Example
{
    public class ExampleModule : SongsSearchModule
    {
        public ExampleModule()
        {
            setInfo("搜索模块名字", "作者名字", "联系方式", "版本号", "搜索模块说明", 是否支持歌词);
            // 是否支持歌词仅用作显示，不影响调用Search时传入的参数
            // 联系方式会在搜索模块抛出错误时使用
            // setInfo只有第一次调用时有效
            
            // 使用Log输出日志和弹幕，MianPluginVersion为点歌姬的版本号
            Log($"点歌姬 {MianPluginVersion} 加载搜索模块 {ModuleName} 成功！", true);
            
            // 其他内容可在 Visual Studio 的对象浏览器中查看
        }

        protected override SongItem Search(string username, string str, bool needLyric = false)
        {
            // 在此处进行歌曲搜索解析操作
            if (false)
            { // 搜索成功的情况
                return SongItem.init(this, "歌名", "歌曲ID", username, "歌手数组", "下载地址", "歌词(可选)", "歌曲说明(可选，暂时没有使用)");
                // 请不要对username进行任何变动
                // 无歌词请返回String.Ematy
            } else { // 搜索失败的情况
                Log("搜索失败的原因"); // 可选，但是尽量输出
                return null; // null代表没搜到
            }
        }
    }
}
```
-->
